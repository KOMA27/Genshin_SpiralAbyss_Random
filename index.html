<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>原神 深境螺旋 抽選ツール</title>
<style>
body{font-family:sans-serif;background:#f6f6f6;padding:20px}
h1{text-align:center}
button{padding:8px 16px;font-size:15px;cursor:pointer;margin:6px}
.filters{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin-bottom:10px}
.filters label{background:#fff;padding:6px 10px;border-radius:6px}
.character-grid{display:grid;grid-template-columns:repeat(auto-fill,80px);gap:12px;margin:15px 0}
.char{text-align:center;cursor:pointer}
.char img{width:72px;height:72px;border-radius:10px;object-fit:cover}
.char.off img{filter:grayscale(100%) brightness(60%)}
.char span{font-size:11px}
.teams{display:flex;gap:20px}
.team{background:#fff;padding:10px;border-radius:10px;width:50%}
.team h2{border-bottom:2px solid #333}
li{display:flex;align-items:center;margin:6px 0}
li img{width:48px;height:48px;margin-right:6px;border-radius:8px;object-fit:cover}
</style>
</head>
<body>
<h1>原神 深境螺旋 抽選ツール</h1>

<div class="filters">
<label><input type="checkbox" id="r4" checked>★4</label>
<label><input type="checkbox" id="r5" checked>★5</label>
<label><input type="checkbox" class="el" value="炎" checked>炎</label>
<label><input type="checkbox" class="el" value="水" checked>水</label>
<label><input type="checkbox" class="el" value="風" checked>風</label>
<label><input type="checkbox" class="el" value="雷" checked>雷</label>
<label><input type="checkbox" class="el" value="氷" checked>氷</label>
<label><input type="checkbox" class="el" value="草" checked>草</label>
<label><input type="checkbox" class="el" value="岩" checked>岩</label>
</div>

<div style="text-align:center">
<button onclick="draw()">抽選</button>
<button onclick="draw(true)">再抽選</button>
</div>

<div id="grid" class="character-grid"></div>

<div class="teams">
<div class="team"><h2>前半</h2><ul id="t1"></ul></div>
<div class="team"><h2>後半</h2><ul id="t2"></ul></div>
</div>

<script>
const wiki='https://wikiwiki.jp/genshinwiki/画像/';
const characters="+js+";

let owned=new Set(JSON.parse(localStorage.getItem('owned')||JSON.stringify(characters.map(c=>c.name))));

function save(){localStorage.setItem('owned',JSON.stringify([...owned]));}
function imgUrl(name){
  // wikiwiki.jp キャラクター一覧ページ準拠のキャラクター画像（ローカル保存なし）
  // 例: https://wikiwiki.jp/genshinwiki/画像/アンバー.webp
  return 'https://wikiwiki.jp/genshinwiki/画像/' + encodeURIComponent(name) + '.webp';
}
function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}}

function renderGrid(){
 const g=document.getElementById('grid');g.innerHTML='';
 characters.forEach(c=>{
  const d=document.createElement('div');d.className='char'+(owned.has(c.name)?'':' off');
  d.onclick=()=>{owned.has(c.name)?owned.delete(c.name):owned.add(c.name);save();renderGrid();};
  d.innerHTML=`<img src="${imgUrl(c.name)}"><span>${c.name}</span>`;
  g.appendChild(d);
 });
}

function draw(){
 const els=[...document.querySelectorAll('.el:checked')].map(e=>e.value);
 const r4=document.getElementById('r4').checked;
 const r5=document.getElementById('r5').checked;
 let pool=characters.filter(c=>owned.has(c.name)&&els.includes(c.element)&&((c.rarity==4&&r4)||(c.rarity==5&&r5)));
 if(pool.length<8){alert('対象キャラが8人未満です');return;}
 shuffle(pool);const p=pool.slice(0,8);
 ['t1','t2'].forEach(id=>document.getElementById(id).innerHTML='');
 p.slice(0,4).forEach(c=>add('t1',c));p.slice(4).forEach(c=>add('t2',c));
}
function add(id,c){const li=document.createElement('li');li.innerHTML=`<img src="${imgUrl(c.name)}">${c.name}`;document.getElementById(id).appendChild(li)}

renderGrid();
</script>
</body>
</html>
