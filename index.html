document.getElementById('drawBtn').onclick = async () => {
  pool.innerHTML = teamA.innerHTML = teamB.innerHTML = '';

  const r4 = document.getElementById('r4').checked;
  const r5 = document.getElementById('r5').checked;
  const els = [...document.querySelectorAll('.el:checked')].map(e => e.value);

  let base = characters.filter(c =>
    owned.has(c.name) &&
    els.includes(c.element) &&
    ((c.rarity === 4 && r4) || (c.rarity === 5 && r5))
  );

  if (base.length < 8) {
    alert('抽選対象が8人未満です');
    return;
  }

  // 8枠を1つずつ決定
  for (let slot = 0; slot < 8; slot++) {
    // シャッフル演出
    for (let i = 0; i < 10; i++) {
      pool.innerHTML = '';
      [...pool.children].forEach(c => pool.appendChild(c));

      const tmp = shuffle(base)[0];
      const d = document.createElement('div');
      d.className = 'card shuffling';
      d.innerHTML = `<img src="${icon(tmp)}">${tmp.name}`;
      pool.appendChild(d);

      await sleep(70);
    }

    // 確定
    const picked = shuffle(base)[0];
    base = base.filter(c => c !== picked);

    const card = createCard(picked);
    pool.appendChild(card);

    await sleep(150);
  }
};
